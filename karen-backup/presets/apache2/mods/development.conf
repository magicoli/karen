# Description: Development environment configuration
# This configuration conflicts with production.conf and they cannot be enabled simultaneously

Include conf-available/essentials.conf

Define DEV_SERVER
UnDefine PROD_SERVER

# Include environment-neutral performance settings
# Include conf.enabled/performance-environment.conf

# Development-specific headers and COMPLETE cache disabling
<IfModule mod_headers.c>
  # Development: disable ALL caching completely
  Header always set Cache-Control "no-cache, no-store, must-revalidate, max-age=0"
  Header always set Pragma "no-cache" 
  Header always set Expires "0"
  
  # Disable ETags and Last-Modified to prevent conditional requests
  Header always unset ETag
  Header always unset Last-Modified
  
  # Add development indicators
  Header always set X-Environment "development"
</IfModule>

# CRITICAL: Disable ALL Apache caching modules in development
<IfModule mod_expires.c>
  ExpiresActive Off
</IfModule>

<IfModule mod_cache.c>
  CacheDisable /
</IfModule>

<IfModule mod_cache_disk.c>
  CacheDisable /
</IfModule>

# Disable ETags globally in development
FileETag None

# Force fresh responses - no server-side caching
<Directory />
  ExpiresActive Off
  # Prevent any form of caching
  <IfModule mod_headers.c>
    Header always set Cache-Control "no-cache, no-store, must-revalidate, max-age=0, private"
    Header always set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
  </IfModule>
</Directory>

# PHP-FPM: Use development-specific pool with NO caching
<IfModule mod_proxy_fcgi.c>
  <FilesMatch "\.php$">
    SetHandler "proxy:unix:/run/php/php8.3-fpm-dev.sock|fcgi://localhost"
  </FilesMatch>
</IfModule>

# Disable any server-side caching mechanisms
<IfModule mod_rewrite.c>
  RewriteEngine On
  # Add timestamp to prevent any internal caching
  RewriteRule .* - [E=no-cache:1]
</IfModule>

# Ensure no server-side response caching
<IfModule mod_env.c>
  SetEnv no-cache 1
  SetEnv no-store 1
</IfModule>

# Enable server-info and server-status on development (localhost only)
<IfModule mod_info.c>
  <Location "/server-info">
    SetHandler server-info
    Require ip 127.0.0.1
    Require ip ::1
    Require local
  </Location>
</IfModule>
