# Magic Wrap CMS framework application snippet for Apache
# Usage: IncludeOptional $KAREN_ETC/apache2/snippets/wrap-app.conf
# Requires: mod_rewrite

Alias /lib/ $KAREN_BASE/www/lib/

# Use DirectoryIndex for wrap sites
DirectoryIndex index.html index.htm index.php /lib/wrap/wrap.php

<Directory $KAREN_BASE/www/lib>
  <IfVersion < 2.3>
    Order allow,deny
    Allow from all
  </IfVersion>
  <IfVersion >= 2.3>
    Require all granted
  </IfVersion>
  Options All
  AllowOverride All
</Directory>

# <IfModule mod_rewrite.c>
#   RewriteEngine On
  
#   # Wrap framework routing
#   # Allow access to actual files and directories
#   RewriteCond %{REQUEST_FILENAME} !-f
#   RewriteCond %{REQUEST_FILENAME} !-d
  
#   # Route everything through the wrap framework
#   RewriteRule ^(.*)$ /lib/wrap/wrap.php [QSA,L]
  
#   # Block direct access to wrap internal files
#   RewriteRule ^lib/wrap/internal/.* - [F,L]
#   RewriteRule ^lib/wrap/.*\.inc\.php$ - [F,L]
# </IfModule>

# Security for Wrap framework
<Files "*.inc.php">
  Require all denied
</Files>

<Files "*.conf">
  Require all denied
</Files>

<Directory "*/lib/wrap/internal/*">
  Require all denied
</Directory>
