# WordPress-specific configuration snippet
# Uses SITE_ROOT and SITE_NAME variables from site config
# PHP processing is handled by environment-specific pools (dev/production pseudo-modules)

<IfModule mod_proxy_fcgi.c>
  <FilesMatch "\.php$">
    # PHP admin values cannot be set here, use .user.ini in document root
    # For PHP-FPM: Use .user.ini in document root for per-site configuration
  </FilesMatch>
</IfModule>

<IfModule mod_php.c>
  # WordPress memory requirements
  php_admin_value memory_limit 256M
  
  # WordPress execution time for complex operations  
  php_admin_value max_execution_time 61
  
  # WordPress forms and media uploads
  php_admin_value max_input_vars 3002
  php_admin_value post_max_size 103M
  php_admin_value upload_max_filesize 104M
  
  # WordPress file operations
  php_admin_value max_file_uploads 25
  
  # WordPress session handling
  php_admin_value session.gc_maxlifetime 3606
</IfModule>

<IfModule mod_proxy_fcgi.c>
  # NOTE: PHP-FPM cannot override pool settings via Apache directives
  # To customize PHP settings for this WordPress site:
  # 1. Create .user.ini in the site's document root with:
  #    memory_limit=256M
  #    max_execution_time=61
  #    max_input_vars=3002
  #    post_max_size=103M
  #    upload_max_filesize=104M
  #    max_file_uploads=25
  #    session.gc_maxlifetime=3606
  # 2. Or create a site-specific PHP-FPM pool if extensive customization is needed
</IfModule>

# NOTE: PHP-FPM routing is handled by development.conf or production.conf pseudo-modules
# This snippet only contains WordPress-specific settings
  
# WordPress security and performance optimizations
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Block access to XML-RPC (prevent brute force attacks)
  RewriteRule ^xmlrpc\.php$ - [F,L]
  
  # Block WordPress configuration and sensitive files
  RewriteRule ^wp-config\.php$ - [F,L]
  RewriteRule ^wp-config-sample\.php$ - [F,L]
  RewriteRule ^\.htaccess$ - [F,L]
  RewriteRule ^readme\.html$ - [F,L]
  RewriteRule ^license\.txt$ - [F,L]
  
  # Block access to wp-includes PHP files
  RewriteRule ^wp-includes/.*\.php$ - [F,L]
  
  # Allow only necessary wp-admin files for non-admin requests
  RewriteCond %{REQUEST_URI} !^/wp-admin/admin-ajax\.php
  RewriteCond %{REQUEST_URI} !^/wp-admin/admin-post\.php
  RewriteRule ^wp-admin/.*\.php$ - [F,L]
</IfModule>

# WordPress-specific file security (legacy Files blocks removed - using rewrite rules above)
# All WordPress security is now consistently handled through mod_rewrite

# Limit access to wp-admin (uncomment and customize as needed)
# (interesting but must not enabled by default)
# <Directory "wp-admin">
#   <RequireAll>
#     Require ip 127.0.0.1
#     Require ip 192.168.1.0/24
#   </RequireAll>
# </Directory>
