# Ursull server Configuration  

# Global options
{
	# Other global options (optional)
}
# import /etc/caddy/sites-enabled/*.caddy

# On dev servers:
(local_tls) {
	tls internal
}

# On production servers:
# (local_tls) {
# }

# End of /etc/caddy/Caddyfile


# Temporarily combined in Caddyfile for easier testing
# /etc/caddy/sites-enabled/agnstk.org.caddy
agnstk.org, dev.agnstk.org {
	# Set document root
	root * /home/magic/domains/agnstk.org/www

	# Handle agnstk application - preserve full path
	handle /agnstk* {
		root * /home/magic/domains/agnstk.org/www

		# Serve public assets directly
		handle /agnstk/public/* {
			root * /home/magic/domains/agnstk.org/www/agnstk/public
			rewrite * {path}
			file_server
		}

		# All other agnstk requests go to agnstk/index.php
		handle {
			try_files {path} {path}/ /agnstk/index.php?{query}
			php_fastcgi unix//run/php/php8.3-fpm.sock
		}
	}

	# Default handler for non-agnstk requests
	file_server

	log {
		output file /var/log/caddy/agnstk.org.access.log
		format console
	}

	import local_tls
}
