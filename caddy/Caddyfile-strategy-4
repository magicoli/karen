# Ursull server Configuration  

# Global options
{
	# Other global options (optional)
}
# import /etc/caddy/sites-enabled/*.caddy

# On dev servers:
(local_tls) {
	tls internal
}

# On production servers:
# (local_tls) {
# }

# End of /etc/caddy/Caddyfile


# Temporarily combined in Caddyfile for easier testing
# /etc/caddy/sites-enabled/agnstk.org.caddy
agnstk.org, dev.agnstk.org {
	root * /home/magic/domains/agnstk.org/www

	# Only handle requests starting with /agnstk
	@agnstk {
		path /agnstk*
	}

	# Serve static files in /agnstk/core/public directly
	@agnstk_public {
		path /agnstk/core/public/*
		file
	}
	handle @agnstk_public {
		root * /home/magic/domains/agnstk.org/www/agnstk/core/public
		rewrite * {path}
		file_server
	}

	# Laravel front controller for /agnstk (non-static)
	handle @agnstk {
		try_files {path} {path}/ /agnstk/index.php?{query}
		php_fastcgi unix//run/php/php8.3-fpm.sock {
			env SCRIPT_NAME /agnstk/index.php
			env SCRIPT_FILENAME /home/magic/domains/agnstk.org/www/agnstk/index.php
		}
	}

	# Optionally, serve other static files (favicon, robots.txt, etc.) from root
	file_server

	log {
		output file /var/log/caddy/agnstk.org.access.log
		format console
	}

	import local_tls
}
