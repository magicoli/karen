# PHP monitoring endpoints snippet
# Usage: IncludeOptional $KAREN_ETC/apache2/snippets/php-monitoring.conf
# Enables PHP-FPM status and monitoring endpoints

# PHP-FPM status endpoint
<Location "/fpm-status">
  <IfDefine USE_WWW_POOL>
    SetHandler "proxy:unix:/run/php/php8.3-fpm-${SITE_NAME}.sock|fcgi://localhost"
  </IfDefine>
  <IfDefine !USE_WWW_POOL>
    SetHandler "proxy:unix:/run/php/php8.3-fpm.sock|fcgi://localhost"
  </IfDefine>
  
  # Restrict access to monitoring
  Require ip 127.0.0.1
  Require ip ::1
  Require local
  
  # Optional: allow specific monitoring IPs
  # Require ip 192.168.1.0/24
</Location>

# PHP-FPM ping endpoint  
<Location "/fpm-ping">
  <IfDefine USE_WWW_POOL>
    SetHandler "proxy:unix:/run/php/php8.3-fpm-${SITE_NAME}.sock|fcgi://localhost"
  </IfDefine>
  <IfDefine !USE_WWW_POOL>
    SetHandler "proxy:unix:/run/php/php8.3-fpm.sock|fcgi://localhost"
  </IfDefine>
  
  # Restrict access to monitoring
  Require ip 127.0.0.1
  Require ip ::1
  Require local
</Location>
