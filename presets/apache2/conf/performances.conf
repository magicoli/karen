# Environment-Neutral Performance Configuration for Apache
# This file contains settings that apply to both DEV and PROD environments
# Must be included by either production.conf or development.conf
# Usage: Include $KAREN_ETC/apache2/conf/performance-environment.conf

# Performance optimizations
<IfModule mod_deflate.c>
  # Enable compression
  SetOutputFilter DEFLATE
  SetEnvIfNoCase Request_URI \
    \.(?:gif|jpe?g|png)$ no-gzip dont-vary
  SetEnvIfNoCase Request_URI \
    \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
</IfModule>

# HTTP/2 support when available
<IfModule mod_http2.c>
  Protocols h2 http/1.1
</IfModule>

# NOTE: Critical security settings (PHP processing, security headers)
# have been moved to etc/apache2/conf/magiiic-commons.conf
# to ensure they can never be accidentally disabled

# SSL/TLS configuration for both environments
<IfModule mod_ssl.c>
  # Modern SSL configuration
#   SSLEngine off  # Will be enabled per-vhost
  SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
  SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
  SSLHonorCipherOrder off
  SSLSessionTickets off
</IfModule>

# Global PHP settings (will be overridden by PHP-FPM pool configs)
# These only apply if mod_php is accidentally enabled (should be disabled)
<IfModule mod_php.c>
  # WARNING: mod_php should be disabled in favor of PHP-FPM
  php_admin_value open_basedir "$KAREN_BASE/www/lib:/usr/share:/var/lib:/var/tmp"
  php_admin_value upload_max_filesize "100M"
  php_value post_max_size "100M"
  php_value max_execution_time 60
</IfModule>
