# gites-mosaiques.com - Clean semantic Apache configuration
# Pure include-based approach with variables

# HTTP to HTTPS redirect
<VirtualHost *:80>
  # Primary server configuration
  ServerName gites-mosaiques.com
  ServerAlias www.gites-mosaiques.com
  ServerAlias dev.gites-mosaiques.com
  
  # Minimal config as failsafe if SSL is not enabled
  Define SITE_NAME gites-mosaiques.com
  Define SITE_USER mosaiques
  Define SITE_ROOT /home/${SITE_USER}/domains/${SITE_NAME}/www
  DocumentRoot ${SITE_ROOT}

  # Redirect if SSL conf is enabled
  <ifModule mod_rewrite.c>
    RewriteEngine On
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
  </ifModule>
</VirtualHost>

# Main HTTPS site
<VirtualHost *:443>
  ServerName gites-mosaiques.com
  ServerAlias www.gites-mosaiques.com
  ServerAlias dev.gites-mosaiques.com
  
  # Site variables (used by includes)
  Define SITE_NAME gites-mosaiques.com
  Define SITE_ROOT /home/mosaiques/domains/gites-mosaiques.com/www
  Define SITE_USER mosaiques
  
  # Use variables in config
  DocumentRoot ${SITE_ROOT}
  
  # Directory settings
  <Directory ${SITE_ROOT}>
    Require all granted
    AllowOverride All
    Options -Indexes +FollowSymLinks -MultiViews
  </Directory>

  # SSL configuration
  Include snippets/ssl-engine.conf

  # Core functionality includes
  Include snippets/security-headers.conf
  Include snippets/static-files.conf
  Include snippets/logging.conf
  
  # Application type: WordPress
  Include snippets/app-wordpress.conf
  
  # Optional features
  IncludeOptional snippets/enhanced-logging.conf
  IncludeOptional snippets/php-monitoring.conf
  
  # Site-specific overrides go here
  # ErrorDocument 404 /404.php
</VirtualHost>
