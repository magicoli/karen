# example.org - Clean semantic Apache configuration
# Pure include-based approach with variables

# HTTP to HTTPS redirect
<VirtualHost *:80>
  # Primary server configuration
  ServerName example.org
  ServerAlias www.example.org
  ServerAlias dev.example.org
  
  # Minimal config as failsafe if SSL is not enabled
  Define SITE_DOMAIN example.org
  Define SITE_USER example_user
  Define SITE_ROOT /home/${SITE_USER}/domains/${SITE_DOMAIN}/www
  DocumentRoot ${SITE_ROOT}

  # Let's not care yet about the redirect
  <ifModule mod_rewrite.c>
    RewriteEngine On
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
  </ifModule>
</VirtualHost>

# Main HTTPS site
<VirtualHost *:443>
  ServerName example.org
  ServerAlias www.example.org
  ServerAlias dev.example.org
  
  # Site variables (used by includes)
  Define SITE_DOMAIN example.org
  Define SITE_USER example_user
  Define SITE_ROOT /home/${SITE_USER}/domains/${SITE_DOMAIN}/www
  
  DocumentRoot ${SITE_ROOT}
  
  # Directory settings
  <Directory ${SITE_ROOT}>
    Require all granted
    AllowOverride All
    Options -Indexes +FollowSymLinks -MultiViews
  </Directory>

  ## Application-specific includes
  # Include snippets/app-wordpress.conf
  # Include snippets/app-wrap.conf
  # Include snippets/app-agnstk.conf
  # Include snippets/app-nextcloud.conf
  # Include snippets/app-roundcube.conf
  # ...

  # SSL configuration
  Include snippets/ssl-engine.conf

  # Core functionality includes
  Include snippets/security-headers.conf
  Include snippets/static-files.conf
  Include snippets/logging.conf
  
  # Application type: WordPress
  Include snippets/app-wordpress.conf
  
  # Optional features
  IncludeOptional snippets/enhanced-logging.conf
  IncludeOptional snippets/php-monitoring.conf
  
  # Site-specific overrides go here
  # ErrorDocument 404 /404.php
</VirtualHost>
