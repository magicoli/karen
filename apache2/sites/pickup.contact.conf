<VirtualHost *:80>
  <ifmodule mpm_itk_module>
    AssignUserID magic magic
  </ifmodule>
  <ifmodule suexec_module>
    SuexecUserGroup magic magic
  </ifmodule>
  ServerName pickup.contact
  ServerAlias www.pickup.contact
  ServerAlias *.pickup.contact

  DocumentRoot /home/magic/domains/pickup.contact/www
  ErrorLog /var/log/apache2/pickup.contact.error.log
  CustomLog /var/log/apache2/pickup.contact.access.log combined

# DirectoryIndex index.html index.htm index.php /lib/wrap/wrap.php

  <Directory /home/magic/domains/pickup.contact/www>
    <IfVersion < 2.3>
      Order allow,deny
      Allow from all
    </IfVersion>
    <IfVersion >= 2.3>
      Require all granted
    </IfVersion>
    Options -Indexes +Includes +IncludesNOEXEC +SymLinksIfOwnerMatch
    AllowOverride All
  </Directory>

  <Directory /home/magic/domains/pickup.contact/www/.git>
     Order allow,deny
     Deny from all
  </Directory>
  <Directory /home/magic/domains/pickup.contact/tmp/www/www>
    AllowOverride All
  </Directory>

  php_admin_value open_basedir "/opt/magic/lib:/usr/share:/var/lib:/var/tmp:/home/magic/domains/pickup.contact:."
  php_admin_value upload_tmp_dir "/home/magic/domains/pickup.contact/tmp/www/www"
  php_admin_value session.save_path "/home/magic/domains/pickup.contact/tmp/www/www"
  php_value memory_limit 256M
  php_value max_input_vars 2000
  php_value max_execution_time 60
  # php_value upload_max_filesize "100M"
  # php_value post_max_size "100M"
  # php_value sendmail_path "/usr/sbin/sendmail -t -i -f webmaster@pickup.contact"

  # RewriteEngine on
  # RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]

RewriteEngine on
RewriteCond %{SERVER_NAME} =www.pickup.contact [OR]
RewriteCond %{SERVER_NAME} =*.pickup.contact [OR]
RewriteCond %{SERVER_NAME} =pickup.contact
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
