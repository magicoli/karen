# Angstk framework configuration snippet for Apache  
# Usage: IncludeOptional /opt/magic/etc/apache2/snippets/angstk.conf
# Requires: mod_rewrite

<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Angstk framework routing (modern routing)
  # Allow access to actual files and directories
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  
  # Route through Angstk front controller
  RewriteRule ^(.*)$ /index.php [QSA,L]
  
  # Block access to framework internals
  RewriteRule ^angstk/.* - [F,L]
  RewriteRule ^vendor/.* - [F,L]
  RewriteRule ^storage/.*(?<!\.css|\.js|\.png|\.jpg|\.jpeg|\.gif|\.ico|\.svg|\.woff|\.woff2|\.ttf|\.eot)$ - [F,L]
</IfModule>

# Security for Angstk framework
<Files ".env">
  Require all denied
</Files>

<Files "composer.json">
  Require all denied
</Files>

<Files "composer.lock">
  Require all denied
</Files>

<Files "package.json">
  Require all denied
</Files>

<Files "package-lock.json">
  Require all denied
</Files>

<Directory "*/angstk/*">
  Require all denied
</Directory>

<Directory "*/vendor/*">
  Require all denied
</Directory>

<Directory "*/storage/app/*">
  Require all denied
</Directory>

<Directory "*/storage/framework/*">
  Require all denied
</Directory>

<Directory "*/storage/logs/*">
  Require all denied
</Directory>

# Allow public storage access
<Directory "*/storage/public/*">
  Require all granted
</Directory>
