# SSL Auto-configuration snippet
# Uses SITE_DOMAIN variable to auto-detect certificates
# Standard approach: certificate name matches ServerName

SSLEngine on

# Try Let's Encrypt certificate first (standard production setup)
<IfFile "/etc/letsencrypt/live/${SITE_DOMAIN}/fullchain.pem">
  SSLCertificateFile /etc/letsencrypt/live/${SITE_DOMAIN}/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/${SITE_DOMAIN}/privkey.pem
  
  # Include Let's Encrypt SSL options if available
  <IfFile "/etc/letsencrypt/options-ssl-apache.conf">
    Include /etc/letsencrypt/options-ssl-apache.conf
  </IfFile>
</IfFile>

# Fallback to snakeoil certificate for local development
<IfFile "!/etc/letsencrypt/live/${SITE_DOMAIN}/fullchain.pem">
  SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
  SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
  
  # Basic SSL configuration for local development
  SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
  SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
  SSLHonorCipherOrder off
</IfFile>
