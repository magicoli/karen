# WordPress-specific configuration snippet
# Uses SITE_ROOT and SITE_DOMAIN variables from site config
# Routes PHP through wordpress.sock pool

# PHP-FPM routing for WordPress-optimized pool
ProxyPassMatch ^/(.*\.php(/.*)?)$ unix:/run/php/wordpress.sock|fcgi://localhost${SITE_ROOT}/$1
  
#   # Block access to XML-RPC (prevent brute force attacks)
#   RewriteRule ^xmlrpc\.php$ - [F,L]
  
#   # Block access to wp-includes and wp-admin for non-admin requests
#   RewriteRule ^wp-admin/(?!admin-ajax\.php) - [F,L]
#   RewriteRule ^wp-includes/(?!.*\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$) - [F,L]
# </IfModule>


## Good: make sure basic security rules are in place
# Additional security for WordPress
<Files "wp-config.php">
  Require all denied
</Files>

<Files "wp-config-sample.php">
  Require all denied
</Files>

<Files ".htaccess">
  Require all denied
</Files>

<Files "readme.html">
  Require all denied
</Files>

<Files "license.txt">
  Require all denied
</Files>

## Interesting but must be handled with a separate snippet
# Limit access to wp-admin (uncomment and customize as needed)
# <Directory "wp-admin">
#   <RequireAll>
#     Require ip 127.0.0.1
#     Require ip 192.168.1.0/24
#   </RequireAll>
# </Directory>
